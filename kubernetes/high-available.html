
<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <title>é«˜å¯ç”¨é›†ç¾¤ | IceOfSummerã®åšå®¢</title>
        <meta name="author" content="IceOfSummer" />
        <meta name="description" content="åé¢ä¸€è¾ˆå­çš„åšå®¢éƒ½åœ¨è¿™äº†ï¼" />
        <meta name="keywords" content="" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
        <script src="https://selfb.asia/static/lib/vue-3.2.47.global.prod.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.3.0/css/all.min.css" />
<link rel="stylesheet" href="https://selfb.asia/static/particlex/static/fonts.min.css" />
<script>
  const mixins = {};
  const h = (arg1, arg2, arg3) => {
    if (arg2.attrs) {
      Object.assign(arg2, arg2.attrs)
      Reflect.deleteProperty(arg2, 'attrs')
    }
    if (arg2.on) {
      Object.keys(arg2.on).forEach(key => {
        const head = key.charAt(0).toUpperCase()
        arg2['on' + head  + key.substring(1)] = arg2.on[key]
      })
      Reflect.deleteProperty(arg2, 'on')
    }
    return Vue.h(arg1, arg2, arg3)
  }
</script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script src="https://selfb.asia/static/lib/highlight-11.7.0.min.js"></script>
<link
    rel="stylesheet"
    href="https://cdn.staticfile.org/highlight.js/11.7.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

  <script src="/js/lib/toc.js"></script>



  <script src="/js/lib/lazy-load-support.js"></script>


    <meta name="generator" content="Hexo 7.3.0"></head>
    <body>
        <div id="layout">
            <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>åŠ è½½è¿‡æ…¢è¯·å¼€å¯ç¼“å­˜&ensp;æµè§ˆå™¨é»˜è®¤å¼€å¯</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
            </transition>
            <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/">
            <span>ICEOFSUMMERã®åšå®¢</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;ICEOFSUMMERã®åšå®¢</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>é«˜å¯ç”¨é›†ç¾¤</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/7/10
        </span>
        
        <span class="category">
            <a href="/2024/02/08/k8s">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                k8s
            </a>
        </span>
        
        
    </div>
    
    <toc-component></toc-component>
    <div class="content" v-pre id="main-content">
        <h1 id="K8s-é›†ç¾¤æ¶æ„"><a href="#K8s-é›†ç¾¤æ¶æ„" class="headerlink" title="K8s é›†ç¾¤æ¶æ„"></a>K8s é›†ç¾¤æ¶æ„</h1><p>etcdï¼šä¿è¯ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹é”™æ€§ï¼Œä½¿ç”¨ <a target="_blank" rel="noopener" href="http://www.kailing.pub/raft/index.html">raft</a> åè®®æ¥ä¿æŒä¸€è‡´æ€§ã€‚</p>
<p>ä¸€ä¸ª raft ä¸€è‡´æ€§çš„é›†ç¾¤è‡³å°‘æœ‰ <code>n/2 + 1</code> å°æœºå™¨å¯ç”¨(å¿½ç•¥å°æ•°)ï¼Œä½äºè¯¥å€¼ï¼Œé›†ç¾¤å°†ä¸å¯ç”¨ã€‚</p>
<p>ä¸€èˆ¬é›†ç¾¤æ•°é‡åº”è¯¥ä¸ºå¥‡æ•°ä¸ªï¼Œä»¥é˜²æ­¢æ¯æ¬¡é€‰å–é¢†å¯¼è€…æ—¶å‡ºç°â€å¹³ç¥¨â€çš„æƒ…å†µï¼Œæ­¤æ—¶ä¼šå¯¼è‡´å¤šæ¬¡é‡è¯•ï¼Œå½±å“æœåŠ¡æ€§èƒ½ã€‚</p>
<p>ä¸€æ—¦åˆ†åŒºï¼Œå°±äº§ç”Ÿè„‘è£‚é—®é¢˜ï¼Œå¯¼è‡´å‡ºç°å¤šä¸ªé¢†å¯¼è€…ï¼Œä½†æ˜¯é¢†å¯¼è€…ä»ç„¶éµä»å†™å…¥æ•°æ®æ—¶ï¼Œè¿‡åŠèŠ‚ç‚¹å“åº”æ‰èƒ½å¤Ÿå†™å…¥çš„è§„åˆ™ï¼Œå› æ­¤å½“åœ¨èŠ‚ç‚¹æ•°è¾ƒå°‘çš„é¢†å¯¼è€…èŠ‚ç‚¹å†™å…¥æ•°æ®æ—¶ï¼Œå°†ä¼šä¸€ç›´å¤±è´¥ã€‚</p>
<p>K8s ä¸­ï¼Œ<strong>é™¤äº† etcd å¤–ï¼Œéƒ½æ˜¯æ— çŠ¶æ€æœåŠ¡</strong>ã€‚</p>
<h1 id="è¯ä¹¦çš„åˆ¶ä½œä¸åˆ†å‘"><a href="#è¯ä¹¦çš„åˆ¶ä½œä¸åˆ†å‘" class="headerlink" title="è¯ä¹¦çš„åˆ¶ä½œä¸åˆ†å‘"></a>è¯ä¹¦çš„åˆ¶ä½œä¸åˆ†å‘</h1><p><a target="_blank" rel="noopener" href="https://github.com/cloudflare/cfssl/releases/">cfssl</a><br><a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/setup/best-practices/certificates/">PKI è¯ä¹¦å’Œè¦æ±‚</a><br><a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/reference/networking/virtual-ips/#proxy-mode-ipvs">IPVS ä»£ç†æ¨¡å¼</a><br><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/master/pkg/proxy/ipvs/README.md">IPVS</a><br><a target="_blank" rel="noopener" href="https://docs.kernel.org/admin-guide/sysctl/index.html">sysctl</a></p>
<p>é›†ç¾¤ç›¸å…³è¯ä¹¦ç±»å‹ï¼š</p>
<ul>
<li><strong>client certificate</strong>ï¼šç”¨äºæœåŠ¡ç«¯è®¤è¯å®¢æˆ·ç«¯</li>
<li><strong>server certificate</strong>ï¼šæœåŠ¡ç«¯ä½¿ç”¨ï¼Œå®¢æˆ·ç«¯ä»¥æ­¤éªŒè¯æœåŠ¡ç«¯èº«ä»½</li>
<li><strong>peer certificate</strong>ï¼šåŒå‘è¯ä¹¦ï¼Œå³æ˜¯ <code>client certificate</code> åˆæ˜¯ <code>server certificate</code></li>
</ul>
<p>åœ¨å‡†å¤‡è¯ä¹¦å‰ï¼Œéœ€è¦å…ˆå½’å®šå¥½é›†ç¾¤çš„ç½‘æ®µï¼š</p>
<ul>
<li>æœºå™¨ç½‘æ®µï¼š192.168.0.* (äº‘æœåŠ¡å™¨æœºå™¨ç½‘æ®µ)</li>
<li>æœåŠ¡ç½‘æ®µï¼š10.96.<em>.</em></li>
<li>Pod ç½‘æ®µï¼š196.16.<em>.</em></li>
</ul>
<h2 id="å‡†å¤‡æ“ä½œ"><a href="#å‡†å¤‡æ“ä½œ" class="headerlink" title="å‡†å¤‡æ“ä½œ"></a>å‡†å¤‡æ“ä½œ</h2><h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><p>ä¸ºæ¯ä¸ªæœºå™¨å‡†å¤‡åŸŸåï¼š</p>
<pre><code class="sh">cat &lt;&lt; EOF &gt; /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.1.26 k8s-master-1
192.168.1.28 k8s-master-2
192.168.1.29 k8s-master-3
192.168.1.32 k8s-node-1
192.168.1.30 k8s-node-2
192.168.1.31 k8s-node-3
192.168.1.34 k8s-master-lb 
EOF
</code></pre>
<blockquote>
<p><code>k8s-master-lb</code> ä¸ºé«˜å¯ç”¨åšå‡†å¤‡ã€‚</p>
<p>è¿™é‡Œæˆ‘ç”¨äº†é˜¿é‡Œäº‘çš„å†…ç½‘ SLBï¼Œè¿™ä¸œè¥¿ä¸çŸ¥é“æ˜¯ä¸æ˜¯æˆ‘çš„é—®é¢˜ï¼Œåæ­£å°±æ˜¯æ¯å½“ä¸»èŠ‚ç‚¹è´Ÿè½½å‡è¡¡åˆ°è‡ªå·±æ—¶ï¼Œè¯·æ±‚å°±ä¼šè¶…æ—¶ï¼Œä½†æ˜¯æˆ‘å•ç‹¬å¼€äº†å°æœåŠ¡å™¨æ­äº†ä¸ª nginx åšè´Ÿè½½å‡è¡¡å°±æ˜¯æ­£å¸¸çš„ã€‚</p>
<p>ğŸ‘ğŸ‘ğŸ‘ è€Œä¸” SLB çœ‹ä¸äº† L4 ä»£ç†çš„æ—¥å¿—ï¼Œæœ‰ç‚¹æ— è¯­ã€‚ã€‚ã€‚</p>
</blockquote>
<p>å…¶å®ƒå¿…è¦æ“ä½œ:</p>
<pre><code class="sh"># å…³é—­ selinux
setenforce 0
sed -i &#39;s#SELINUX=enforcing#SELINUX=disabled#g&#39; /etc/sysconfig/selinux
sed -i &#39;s#SELINUX=enforcing#SELINUX=disabled#g&#39; /etc/selinux/config
# å…³é—­ swap
swapoff -a &amp;&amp; sysctl -w vm.swappiness=0
sed -ri &#39;s/.*swap.*/#&amp;/&#39; /etc/fstab
</code></pre>
<pre><code class="sh"># ä¿®æ”¹ limit
ulimit -SHn 65535
vi /etc/security/limits.conf

# æœ«å°¾æ·»åŠ å¦‚ä¸‹å†…å®¹
* soft nofile 655360
* hard nofile 131072
* soft nproc 655350
* hard nproc 655350
* soft memlock unlimited
* hard memlock unlimited
</code></pre>
<p>å®‰è£… ipvs ç­‰å·¥å…·ï¼š</p>
<pre><code class="sh"># æ‰€æœ‰èŠ‚ç‚¹å®‰è£… ipvs å·¥å…·ï¼Œæ–¹ä¾¿ä»¥åæ“ä½œ ipvsï¼Œipsetï¼Œconntrack ç­‰
yum install ipvsadm ipset sysstat conntrack libseccomp -y
# æ‰€æœ‰èŠ‚ç‚¹é…ç½® ipvs æ¨¡å—ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤
modprobe -- ip_vs
modprobe -- ip_vs_rr
modprobe -- ip_vs_wrr
modprobe -- ip_vs_sh
modprobe -- nf_conntrack
# ä¿®æ”¹ ipvs é…ç½®
cat &lt;&lt; EOF &gt; /etc/modules-load.d/ipvs.conf
ip_vs
ip_vs_ls
ip_vs_wlc
ip_vs_rr
ip_vs_wrr
ip_vs_lblc
ip_vs_lblcr
ip_vs_dh
ip_vs_sh
ip_vs_fo
ip_vs_nq
ip_vs_sed
ip_vs_ftp
ip_vs_sh
nf_conntrack
ip_tables
ip_set
xt_set
ipt_set
ipt_rpfilter
ipt_REJECT
ipip
EOF
</code></pre>
<pre><code class="sh"># å¼€å¯æœåŠ¡ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªæœåŠ¡ï¼Œå°±æŠŠæœºå™¨é‡å¯ã€‚
systemctl enable --now systemd-modules-load-service

# æ£€æµ‹æ˜¯å¦åŠ è½½
[root@k8s-node-1 ~]# lsmod | grep -e ip_vs -e nf_conntrack
ip_vs_ftp              16384  0
nf_nat                 57344  1 ip_vs_ftp
ip_vs_sed              16384  0
ip_vs_nq               16384  0
ip_vs_fo               16384  0
ip_vs_sh               16384  0
ip_vs_dh               16384  0
ip_vs_lblcr            16384  0
ip_vs_lblc             16384  0
ip_vs_wrr              16384  0
ip_vs_rr               16384  0
ip_vs_wlc              16384  0
ip_vs                 192512  23 ip_vs_wlc,ip_vs_rr,ip_vs_dh,ip_vs_lblcr,ip_vs_sh,ip_vs_fo,ip_vs_nq,ip_vs_lblc,ip_vs_wrr,ip_vs_sed,ip_vs_ftp
nf_conntrack          180224  2 nf_nat,ip_vs
nf_defrag_ipv6         24576  2 nf_conntrack,ip_vs
nf_defrag_ipv4         16384  1 nf_conntrack
libcrc32c              16384  4 nf_conntrack,nf_nat,nf_tables,ip_vs
</code></pre>
<p>è®¾ç½®ç³»ç»Ÿå‚æ•°</p>
<pre><code class="sh">cat &lt;&lt; EOF &gt; /etc/sysctl.d/k8s.conf
net.ipv4.ip_forward = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
fs.may_detach_mounts = 1
vm.overcommit_memory=1
net.ipv4.conf.all.route_localnet = 1

vm.panic_on_oom=0
fs.inotify.max_user_watches=89100
fs.file-max = 52706963
fs.nr_open = 52706963
net.netfilter.nf_conntrack_max = 2310720

net.ipv4.tcp_keepalive_time = 600
net.ipv4.tcp_keepalive_intvl = 30
net.ipv4.tcp_keepalive_probes = 10
net.ipv4.tcp_max_tw_buckets = 36000
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_max_orphans = 327680
net.ipv4.tcp_orphan_retries = 3
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_max_syn_backlog = 16768
net.ipv4.ip_conntrack_max = 65536
net.ipv4.tcp_timestamps = 0
net.core.somaxconn = 16768
EOF
# åº”ç”¨è®¾ç½®
sysctl -p
</code></pre>
<p>æœ‰é—®é¢˜å¯ä»¥å»ç¿»æ–‡æ¡£ï¼ˆæ‰¾äº†è€åŠå¤©ï¼‰ï¼š<a target="_blank" rel="noopener" href="https://docs.kernel.org/admin-guide/sysctl/index.html">sysctl</a></p>
<p>å®‰è£… Dockerï¼š</p>
<pre><code class="sh">yum install -y yum-utils
yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
systemctl start docker
</code></pre>
<h3 id="é…ç½®èŠ‚ç‚¹é—´å…å¯†ç™»å½•"><a href="#é…ç½®èŠ‚ç‚¹é—´å…å¯†ç™»å½•" class="headerlink" title="é…ç½®èŠ‚ç‚¹é—´å…å¯†ç™»å½•"></a>é…ç½®èŠ‚ç‚¹é—´å…å¯†ç™»å½•</h3><pre><code class="sh">cd ~/.ssh
ssh-keygen -t rsa
for i in k8s-master-1 k8s-master-2 k8s-master-3 k8s-node-1 k8s-node-2 k8s-node-3;do ssh-copy-id -i ~/.ssh/id_rsa.pub $i;done
</code></pre>
<h2 id="å‡†å¤‡æ ¹è¯ä¹¦"><a href="#å‡†å¤‡æ ¹è¯ä¹¦" class="headerlink" title="å‡†å¤‡æ ¹è¯ä¹¦"></a>å‡†å¤‡æ ¹è¯ä¹¦</h2><h3 id="åˆ›å»º-CA-å…¬é’¥å’Œç§é’¥"><a href="#åˆ›å»º-CA-å…¬é’¥å’Œç§é’¥" class="headerlink" title="åˆ›å»º CA å…¬é’¥å’Œç§é’¥"></a>åˆ›å»º CA å…¬é’¥å’Œç§é’¥</h3><p>åˆ›å»ºä¸€ä¸ª caç­¾åè¯·æ±‚(<code>ca-csr.json</code>)</p>
<pre><code class="json">&#123;
  &quot;CN&quot;: &quot;kubernetes&quot;,
  &quot;key&quot;: &#123;
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
  &#125;,
  &quot;names&quot;: [
    &#123;
      &quot;C&quot;: &quot;CN&quot;,
      &quot;ST&quot;: &quot;Beijing&quot;,
      &quot;L&quot;: &quot;Beijing&quot;,
      &quot;O&quot;: &quot;Kubernetes&quot;,
      &quot;OU&quot;: &quot;Kubernetes&quot;
    &#125;
  ],
  &quot;ca&quot;: &#123;
    &quot;expiry&quot;: &quot;87600h&quot;
  &#125;
&#125;
</code></pre>
<ul>
<li>CN(Common Name): å…¬ç”¨åï¼Œå¿…é¡»å¡«å†™ï¼Œä¸€èˆ¬å¯ä»¥æ˜¯ç½‘ç«™åŸŸå</li>
<li>O(Organization)ï¼šç»„ç»‡åï¼Œå¿…é¡»å¡«å†™ï¼Œå¦‚æœç”³è¯·çš„æ˜¯OVã€EVå‹è¯ä¹¦ï¼Œç»„ç»‡åç§°å¿…é¡»ä¸¥æ ¼å’Œä¼ä¸šåœ¨æ”¿åºœç™»è®°åä¸€è‡´ï¼Œä¸€èˆ¬éœ€è¦å’Œè¥ä¸šæ‰§ç…§ä¸Šçš„åç§°å®Œå…¨ä¸€è‡´ã€‚</li>
<li>OU(Organization Unit)ï¼šå•ä½éƒ¨é—¨ï¼Œæ²¡æœ‰è¿‡å¤šé™åˆ¶ï¼Œå¯ä»¥éšæ„å¡«å†™</li>
<li>C(City)ï¼šç”³è¯·å•ä½æ‰€åœ¨åŸå¸‚</li>
<li>ST(State&#x2F;Province)ï¼šæ‰€åœ¨çœä»½</li>
<li>C(Country Name)ï¼šå›½å®¶åç§°ï¼Œåº”ä½¿ç”¨ä¸¤ä½å­—æ¯çš„ç®€å†™</li>
</ul>
<p>ç”Ÿæˆ ca è¯ä¹¦å’Œç§é’¥ï¼š</p>
<pre><code class="sh">cfssl gencert -initca ca-csr.json | cfssljson -bare ca -
mv ca-key.pem ca.key
mv ca.pem ca.crt
</code></pre>
<hr>
<p>åˆ›å»ºä¸€ä¸ªæ ¹è¯ä¹¦é…ç½®æ–‡ä»¶(<code>ca-config.json</code>ï¼Œå»ºè®®æ”¾åœ¨ <code>/etc/kubernetes/pki</code>)ï¼š</p>
<pre><code class="json">&#123;
  &quot;signing&quot;: &#123;
    &quot;default&quot;: &#123;
      &quot;expiry&quot;: &quot;87600h&quot;
    &#125;,
    &quot;profiles&quot;: &#123;
      &quot;server&quot;: &#123;
        &quot;expiry&quot;: &quot;87600h&quot;,
        &quot;usages&quot;: [
          &quot;signing&quot;,
          &quot;key encipherment&quot;,
          &quot;server auth&quot;
        ]
      &#125;,
      &quot;client&quot;: &#123;
        &quot;expiry&quot;: &quot;87600h&quot;,
        &quot;usages&quot;: [
          &quot;signing&quot;,
          &quot;key encipherment&quot;,
          &quot;server auth&quot;
        ]
      &#125;,
      &quot;peer&quot;: &#123;
        &quot;expiry&quot;: &quot;87600h&quot;,
        &quot;usages&quot;: [
          &quot;signing&quot;,
          &quot;key encipherment&quot;,
          &quot;server auth&quot;,
          &quot;client auth&quot;
        ]
      &#125;,
      &quot;kubernetes&quot;: &#123;
        &quot;expiry&quot;: &quot;87600h&quot;,
        &quot;usages&quot;: [
          &quot;signing&quot;,
          &quot;key encipherment&quot;,
          &quot;server auth&quot;,
          &quot;client auth&quot;
        ]
      &#125;,
      &quot;etcd&quot;: &#123;
        &quot;expiry&quot;: &quot;87600h&quot;,
        &quot;usages&quot;: [
          &quot;signing&quot;,
          &quot;key encipherment&quot;,
          &quot;server auth&quot;,
          &quot;client auth&quot;
        ]
      &#125;
    &#125;
  &#125;
&#125;
</code></pre>
<blockquote>
<p>å®é™…å»ºè®®ä½¿ç”¨ä¸‹é¢çš„ json é…ç½®ï¼Œè¿™é‡Œä¸ºäº†è·Ÿç€è§†é¢‘æ•™ç¨‹ï¼Œæ‰€ä»¥ç”¨äº†ä¸Šé¢çš„</p>
<pre><code class="json">&#123;
  &quot;signing&quot;: &#123;
    &quot;default&quot;: &#123;
      &quot;expiry&quot;: &quot;87600h&quot;
    &#125;,
    &quot;profiles&quot;: &#123;
      &quot;server&quot;: &#123;
        &quot;expiry&quot;: &quot;87600h&quot;,
        &quot;usages&quot;: [
          &quot;signing&quot;,
          &quot;key encipherment&quot;,
          &quot;server auth&quot;
        ]
      &#125;,
      &quot;client&quot;: &#123;
        &quot;expiry&quot;: &quot;87600h&quot;,
        &quot;usages&quot;: [
          &quot;signing&quot;,
          &quot;key encipherment&quot;,
          &quot;client auth&quot;
        ]
      &#125;,
      &quot;mixed&quot;: &#123;
        &quot;expiry&quot;: &quot;87600h&quot;,
        &quot;usages&quot;: [
          &quot;signing&quot;,
          &quot;key encipherment&quot;,
          &quot;server auth&quot;,
          &quot;client auth&quot;
        ]
      &#125;
    &#125;
  &#125;
&#125;
</code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/cloudflare/cfssl/blob/master/doc/cmd/cfssl.txt">å®Œæ•´çš„é…ç½®è¯´æ˜</a></p>
</blockquote>
<p>è¯¥é…ç½®æ–‡ä»¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬åç»­ç­¾å‘è¯ä¹¦ï¼Œä¾‹å¦‚éœ€è¦ç­¾å‘ <code>server</code> è¯ä¹¦æ—¶ï¼Œåªéœ€å°† <code>profile</code> åˆ‡æ¢ä¸º <code>server</code> å³å¯ï¼Œä½¿ç”¨ <code>cfssl print-defaults config</code> å¯ä»¥æŸ¥çœ‹ç›¸å…³æ¨¡æ¿ã€‚</p>
<h2 id="æ­å»º-etcd-é›†ç¾¤"><a href="#æ­å»º-etcd-é›†ç¾¤" class="headerlink" title="æ­å»º etcd é›†ç¾¤"></a>æ­å»º etcd é›†ç¾¤</h2><p><a target="_blank" rel="noopener" href="https://etcd.io/docs/v3.5/op-guide/hardware/">ç¡¬ä»¶å»ºè®®</a><br><a target="_blank" rel="noopener" href="https://etcd.io/docs/v3.5/op-guide/clustering/">Clustering Guide</a></p>
<p>ä¸‹è½½å®‰è£…åŒ…ï¼š<a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/releases/">etcd-releases</a></p>
<p>ä¸‹è½½å®Œæˆåè§£å‹ï¼Œå°†å…¶ä¸­çš„ <code>etcd</code>ã€<code>etcdctl</code> å’Œ <code>etcdutl</code> ç§»åŠ¨åˆ° <code>/usr/local/bin</code>ã€‚</p>
<h3 id="å‡†å¤‡-etcd-è¯ä¹¦"><a href="#å‡†å¤‡-etcd-è¯ä¹¦" class="headerlink" title="å‡†å¤‡ etcd è¯ä¹¦"></a>å‡†å¤‡ etcd è¯ä¹¦</h3><p>åœ¨ <code>/etc/kubernetes/pki</code> ä¸‹åˆ›å»ºä¸€ä¸ª etcd æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾ etcd è¯ä¹¦ã€‚</p>
<p>è¿›å…¥æ–‡ä»¶å¤¹ï¼Œç”Ÿæˆä¸€ä¸ª etcd æ ¹è¯ä¹¦ç­¾åè¯·æ±‚(<code>ca-csr.json</code>)ï¼š</p>
<pre><code class="json">&#123;
  &quot;CN&quot;: &quot;etcd&quot;,
  &quot;key&quot;: &#123;
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
  &#125;,
  &quot;names&quot;: [
    &#123;
      &quot;C&quot;: &quot;CN&quot;,
      &quot;ST&quot;: &quot;Beijing&quot;,
      &quot;L&quot;: &quot;Beijing&quot;,
      &quot;O&quot;: &quot;etcd&quot;,
      &quot;OU&quot;: &quot;etcd&quot;
    &#125;
  ],
  &quot;ca&quot;: &#123;
    &quot;expiry&quot;: &quot;87600h&quot;
  &#125;
&#125;
</code></pre>
<p>ç”Ÿæˆè¯ä¹¦ï¼š</p>
<pre><code class="sh">cfssl gencert -initca ca-csr.json | cfssljson -bare ca -
</code></pre>
<p>åˆ›å»º etcd è¯ä¹¦ç­¾åè¯·æ±‚(<code>server-csr.json</code>)ï¼š</p>
<pre><code class="json">&#123;
  &quot;CN&quot;: &quot;kube-etcd&quot;,
  &quot;key&quot;: &#123;
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
  &#125;,
  &quot;hosts&quot;: [
    &quot;k8s-master-1&quot;,
    &quot;k8s-master-2&quot;,
    &quot;k8s-master-3&quot;,
    &quot;192.168.1.26&quot;,
    &quot;192.168.1.28&quot;,
    &quot;192.168.1.29&quot;,
    &quot;127.0.0.1&quot;,
    &quot;localhost&quot;
  ],
  &quot;names&quot;: [
    &#123;
      &quot;C&quot;: &quot;CN&quot;,
      &quot;L&quot;: &quot;Beijing&quot;,
      &quot;O&quot;: &quot;kube-etcd&quot;,
      &quot;OU&quot;: &quot;System&quot;,
      &quot;ST&quot;: &quot;beijing&quot;
    &#125;
  ]
&#125;
</code></pre>
<p>ä½¿ç”¨ etcd çš„ CA è¯ä¹¦ç­¾å‘ï¼š</p>
<pre><code class="sh">cfssl gencert \
  -ca=/etc/kubernetes/pki/etcd/ca.pem \
  -ca-key=/etc/kubernetes/pki/etcd/ca-key.pem \
  -config=/etc/kubernetes/pki/ca-config.json \
  -profile=etcd \
  server-csr.json | cfssljson -bare /etc/kubernetes/pki/etcd/server
</code></pre>
<p>è¿è¡Œå®Œåä¼šåœ¨ <code>/etc/kubernetes/pki/etcd</code> ç”Ÿæˆ <code>server.pem</code> å’Œ <code>server-key.pem</code>ã€‚</p>
<p>åŒæ ·çš„æ–¹æ³•ï¼Œç”Ÿæˆç»™ etcd é›†ç¾¤ç”¨çš„å¯¹ç­‰è¯ä¹¦(<code>peer-csr.json</code>)ï¼š</p>
<pre><code class="json">&#123;
  &quot;CN&quot;: &quot;kube-etcd-peer&quot;,
  &quot;key&quot;: &#123;
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
  &#125;,
  &quot;hosts&quot;: [
    &quot;k8s-master-1&quot;,
    &quot;k8s-master-2&quot;,
    &quot;k8s-master-3&quot;,
    &quot;192.168.1.26&quot;,
    &quot;192.168.1.28&quot;,
    &quot;192.168.1.29&quot;,
    &quot;127.0.0.1&quot;,
    &quot;localhost&quot;
  ],
  &quot;names&quot;: [
    &#123;
      &quot;C&quot;: &quot;CN&quot;,
      &quot;L&quot;: &quot;Beijing&quot;,
      &quot;OU&quot;: &quot;System&quot;,
      &quot;O&quot;: &quot;kube-etcd-peer&quot;,
      &quot;ST&quot;: &quot;beijing&quot;
    &#125;
  ]
&#125;
</code></pre>
<p>ç­¾å‘ï¼š</p>
<pre><code class="sh">cfssl gencert \
  -ca=/etc/kubernetes/pki/etcd/ca.pem \
  -ca-key=/etc/kubernetes/pki/etcd/ca-key.pem \
  -config=/etc/kubernetes/pki/ca-config.json \
  -profile=etcd \
  peer-csr.json | cfssljson -bare /etc/kubernetes/pki/etcd/peer
</code></pre>
<hr>
<p>æœ€ç»ˆæ–‡ä»¶ï¼š</p>
<pre><code class="sh">[root@k8s-master-1 etcd]# ll
total 48
-rw-r--r-- 1 root root 1037 Jul 14 00:36 ca.csr
-rw-r--r-- 1 root root  239 Jul 14 00:35 ca-csr.json
-rw------- 1 root root 1675 Jul 14 00:36 ca-key.pem
-rw-r--r-- 1 root root 1289 Jul 14 00:36 ca.pem
-rw-r--r-- 1 root root 1163 Jul 14 00:37 peer.csr
-rw-r--r-- 1 root root  394 Jul 14 00:37 peer-csr.json
-rw------- 1 root root 1675 Jul 14 00:37 peer-key.pem
-rw-r--r-- 1 root root 1525 Jul 14 00:37 peer.pem
-rw-r--r-- 1 root root 1151 Jul 14 00:37 server.csr
-rw-r--r-- 1 root root  384 Jul 14 00:37 server-csr.json
-rw------- 1 root root 1675 Jul 14 00:37 server-key.pem
-rw-r--r-- 1 root root 1513 Jul 14 00:37 server.pem
</code></pre>
<p>æ•´ç†è¯ä¹¦ï¼š</p>
<pre><code class="sh">rm -f ca.csr ca-csr.json peer.csr peer-csr.json server.csr server-csr.json
mv ca-key.pem ca.key
mv ca.pem ca.crt
mv peer-key.pem peer.key
mv peer.pem peer.crt
mv server-key.pem server.key
mv server.pem server.crt
</code></pre>
<p>ç„¶åå‘é€ç»™å…¶å®ƒèŠ‚ç‚¹ã€‚</p>
<h3 id="å‡†å¤‡-etcd-é…ç½®æ–‡ä»¶"><a href="#å‡†å¤‡-etcd-é…ç½®æ–‡ä»¶" class="headerlink" title="å‡†å¤‡ etcd é…ç½®æ–‡ä»¶"></a>å‡†å¤‡ etcd é…ç½®æ–‡ä»¶</h3><p><a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/blob/main/etcd.conf.yml.sample">é…ç½®æ–‡ä»¶æ ·ä¾‹</a><br><a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/blob/main/etcdctl/README.md">etcdctl</a></p>
<p>ä¸€èˆ¬æŠŠé…ç½®æ–‡ä»¶æ”¾åœ¨ <code>/etc/etcd</code> ä¸­ï¼š<code>mkdir -p /etc/etcd</code>ã€‚</p>
<p>åœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¸­åˆ†åˆ«é…ç½®(<code>/etc/etcd/etcd.yaml</code>)ï¼š</p>
<pre><code class="yaml"># èŠ‚ç‚¹åç§°ï¼Œä¸èƒ½é‡å¤
name: &#39;etcd-master-1&#39;
data-dir: /var/lib/etcd
wal-dir: /var/lib/etcd/wal
# æœ¬æœº ip + 2380 ç«¯å£ï¼Œä»£è¡¨å’Œé›†ç¾¤é€šè®¯
listen-peer-urls: https://192.168.1.26:2380
# å®¢æˆ·ç«¯æ“ä½œåœ°å€ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨æœ¬æœºæ“ä½œï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ 127.0.0.1
listen-client-urls: https://192.168.1.26:2379,http://127.0.0.1:2379
# å¯¹ç­‰ url
initial-advertise-peer-urls: https://192.168.1.26:2380
# å®¢æˆ·ç«¯åº”è¯¥ä½¿ç”¨çš„ url
advertise-client-urls: https://192.168.1.26:2379
# é›†ç¾¤åœ°å€
initial-cluster: &quot;etcd-master-1=https://192.168.1.26:2380,etcd-master-2=https://192.168.1.28:2380,etcd-master-3=https://192.168.1.29:2380&quot;
# å®¢æˆ·ç«¯è®¿é—®è¯ä¹¦
client-transport-security:
  cert-file: /etc/kubernetes/pki/etcd/server.crt
  key-file: /etc/kubernetes/pki/etcd/server.key
  client-cert-auth: true
  trusted-ca-file: /etc/kubernetes/pki/etcd/ca.crt
  auto-tls: true
# å¯¹ç­‰è¯ä¹¦ï¼Œæ­£å¸¸æƒ…å†µä¸‹è¿˜éœ€è¦é¢å¤–ç­¾å‘ä¸€ä¸ª kube-etcd-peer è¯ä¹¦ï¼Œç”¨äºé›†ç¾¤èŠ‚ç‚¹é—´çš„é€šè®¯
peer-transport-security:
  cert-file: /etc/kubernetes/pki/etcd/peer.crt
  key-file: /etc/kubernetes/pki/etcd/peer.key
  peer-client-cert-auth: true
  trusted-ca-file: /etc/kubernetes/pki/etcd/ca.crt
  auto-tls: true
</code></pre>
<p>å°† <code>etcd</code> åšæˆæœåŠ¡ï¼Œå¼€æœºå¯åŠ¨(<code>/usr/lib/systemd/system/etcd.service</code>)ï¼š</p>
<pre><code class="service">[Unit]
Description=Etcd Service
Documentation=https://etcd.io/docs/v3.5/op-guide/clustering/
After=network.target

[Service]
Type=notify
ExecStart=/usr/local/bin/etcd --config-file=/etc/etcd/etcd.yaml
Restart=on-failure
RestartSec=20
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
Alias=etcd3.service
</code></pre>
<p>å¼€å§‹å¯åŠ¨ï¼š</p>
<pre><code class="sh">systemctl daemon-reload
systemctl enable --now etcd

# å¦‚æœå¯åŠ¨å¤±è´¥ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼š
journalctl -xeu etcd
</code></pre>
<p>æ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p>
<pre><code class="sh">export ETCDCTL_API=3
ENDPOINTS=192.168.1.26:2379,192.168.1.28:2379,192.168.1.29:2379

etcdctl --endpoints=$ENDPOINTS member list --write-out=table --cacert=/etc/kubernetes/pki/etcd/ca.pem --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key
</code></pre>
<p>æœŸæœ›è¾“å‡ºï¼š</p>
<pre><code class="log">[root@k8s-master-1 etcd]# etcdctl member list --write-out=table
+------------------+---------+---------------+---------------------------+---------------------------+------------+
|        ID        | STATUS  |     NAME      |        PEER ADDRS         |       CLIENT ADDRS        | IS LEARNER |
+------------------+---------+---------------+---------------------------+---------------------------+------------+
| a70a3882ca2ed04b | started | etcd-master-2 | https://192.168.1.28:2380 | https://192.168.1.28:2379 |      false |
| aba9edaf5d433902 | started | etcd-master-3 | https://192.168.1.29:2380 | https://192.168.1.29:2379 |      false |
| d59c76c6a4473d61 | started | etcd-master-1 | https://192.168.1.26:2380 | https://192.168.1.26:2379 |      false |
+------------------+---------+---------------+---------------------------+---------------------------+------------+
</code></pre>
<p>å¦‚æœä¸æƒ³æ¯æ¬¡éƒ½æŒ‡å®šå‘½ä»¤è¡Œå‚æ•°ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ ç¯å¢ƒå˜é‡çš„æ–¹å¼æ¥å®ç°(è¯¦è§æœ¬èŠ‚å¼€å¤´çš„ etcdctl é“¾æ¥)ï¼š</p>
<pre><code class="sh">export ETCDCTL_DIAL_TIMEOUT=3s
export ETCDCTL_CACERT=/etc/kubernetes/pki/etcd/ca.crt
export ETCDCTL_CERT=/etc/kubernetes/pki/etcd/server.crt
export ETCDCTL_KEY=/etc/kubernetes/pki/etcd/server.key
export ETCDCTL_ENDPOINTS=192.168.1.26:2379,192.168.1.28:2379,192.168.1.29:2379
</code></pre>
<p><strong>ä»»ä½•é…ç½®éƒ½å¯ä»¥ä»¥ <code>ETCDCTL_</code> å¼€å¤´ï¼ŒåŠ ä¸Šå¤§å°çš„åç§°æ¥è¿›è¡Œé…ç½®</strong>ã€‚</p>
<h3 id="å‡†å¤‡-kube-apiserver-etcd-client-è¯ä¹¦"><a href="#å‡†å¤‡-kube-apiserver-etcd-client-è¯ä¹¦" class="headerlink" title="å‡†å¤‡ kube-apiserver-etcd-client è¯ä¹¦"></a>å‡†å¤‡ kube-apiserver-etcd-client è¯ä¹¦</h3><p>è¿™é‡Œè¿˜éœ€è¦ç»™ apiserver å‡†å¤‡è®¿é—® etcd çš„è¯ä¹¦ï¼Œ*å½“ç„¶ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ etcd çš„ <code>server.crt</code> å’Œ <code>server.key</code>*ã€‚</p>
<p>å‡†å¤‡è¯ä¹¦ç­¾åè¯·æ±‚(<code>apiserver-etcd-client-csr.json</code>ï¼Œ<strong>ç›´æ¥æ”¾åœ¨ pki ç›®å½•ä¸­</strong>)ï¼š</p>
<pre><code class="json">&#123;
  &quot;CN&quot;: &quot;kube-apiserver-etcd-client&quot;,
  &quot;key&quot;: &#123;
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
  &#125;
&#125;
</code></pre>
<p>ç”Ÿæˆè¯ä¹¦ï¼š</p>
<pre><code class="sh">cfssl gencert -ca=/etc/kubernetes/pki/etcd/ca.crt -ca-key=/etc/kubernetes/pki/etcd/ca.key -config=ca-config.json -profile=client apiserver-etcd-client-csr.json | cfssljson -bare /etc/kubernetes/pki/apiserver-etcd-client &amp;&amp; \
rm -f apiserver-etcd-client.csr apiserver-etcd-client-csr.json &amp;&amp; \
mv apiserver-etcd-client-key.pem apiserver-etcd-client.key &amp;&amp; \
mv apiserver-etcd-client.pem apiserver-etcd-client.crt
</code></pre>
<h2 id="äºŒè¿›åˆ¶å®‰è£…-K8s-é›†ç¾¤"><a href="#äºŒè¿›åˆ¶å®‰è£…-K8s-é›†ç¾¤" class="headerlink" title="äºŒè¿›åˆ¶å®‰è£… K8s é›†ç¾¤"></a>äºŒè¿›åˆ¶å®‰è£… K8s é›†ç¾¤</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/tree/master/CHANGELOG">CHANGELOG</a> ä¸­æ‰¾åˆ°è¦å®‰è£…çš„ç‰ˆæœ¬ï¼Œä¸‹è½½å¯¹åº”çš„ Server å’Œ Node Binariesã€‚</p>
<p>åœ¨æ‰€æœ‰ä¸»èŠ‚ç‚¹ä¸Šï¼š</p>
<pre><code class="sh">tar -zxvf kubernetes-server-linux-amd64.tar.gz kubernetes/server/bin/kube&#123;let,ctl,-apiserver,-controller-manager,-scheduler,-proxy&#125;
mv kubernetes/server/bin/* /usr/local/bin/
rm -rf kubernetes
</code></pre>
<p>åœ¨æ‰€æœ‰å·¥ä½œèŠ‚ç‚¹ä¸Šï¼š</p>
<pre><code class="sh">tar -zxvf kubernetes-node-linux-amd64.tar.gz kubernetes/node/bin/kube&#123;let,-proxy&#125;
mv kubernetes/node/bin/* /usr/local/bin/
rm -rf kubernetes
</code></pre>
<h2 id="api-server-è¯ä¹¦å‡†å¤‡"><a href="#api-server-è¯ä¹¦å‡†å¤‡" class="headerlink" title="api-server è¯ä¹¦å‡†å¤‡"></a>api-server è¯ä¹¦å‡†å¤‡</h2><p>åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚(<code>apiserver-csr.json</code>)ï¼š</p>
<pre><code class="json">&#123;
  &quot;CN&quot;: &quot;kube-apiserver&quot;,
  &quot;hosts&quot;: [
    &quot;127.0.0.1&quot;,
    &quot;192.168.1.26&quot;,
    &quot;192.168.1.28&quot;,
    &quot;192.168.1.29&quot;,
    &quot;192.168.1.34&quot;,
    &quot;kubernetes&quot;,
    &quot;kubernetes.default&quot;,
    &quot;kubernetes.default.svc&quot;,
    &quot;kubernetes.default.svc.cluster&quot;,
    &quot;kubernetes.default.svc.cluster.local&quot;
  ],
  &quot;key&quot;: &#123;
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
  &#125;,
  &quot;names&quot;: [
    &#123;
      &quot;C&quot;: &quot;CN&quot;,
      &quot;L&quot;: &quot;Beijing&quot;,
      &quot;ST&quot;: &quot;Beijing&quot;,
      &quot;O&quot;: &quot;Kubernetes&quot;,
      &quot;OU&quot;: &quot;Kubernetes&quot;
    &#125;
  ]
&#125;
</code></pre>
<p>å…¶ä¸­ <code>192.168.1.34</code> ä¸ºè´Ÿè½½å‡è¡¡çš„åœ°å€ã€‚</p>
<p>ç”Ÿæˆè¯ä¹¦ï¼š</p>
<pre><code class="sh">cfssl gencert -ca=/etc/kubernetes/pki/ca.crt -ca-key=/etc/kubernetes/pki/ca.key -config=/etc/kubernetes/pki/ca-config.json -profile=server apiserver-csr.json | cfssljson -bare /etc/kubernetes/pki/apiserver &amp;&amp; \
rm -f apiserver-csr.json apiserver.csr &amp;&amp; \
mv apiserver-key.pem apiserver.key &amp;&amp; \
mv apiserver.pem apiserver.crt
</code></pre>
<p>ä¸Šé¢çš„åˆ›å»ºå®Œäº†è¿˜éœ€è¦åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦(<code>apiserver-kubelet-client-csr.json</code>)ï¼š</p>
<pre><code class="json">&#123;
  &quot;CN&quot;: &quot;kube-apiserver-kubelet-client&quot;,
  &quot;key&quot;: &#123;
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
  &#125;,
   &quot;names&quot;: [
    &#123;
      &quot;O&quot;: &quot;kubeadm:cluster-admins&quot;
    &#125;
  ]
&#125;
</code></pre>
<p>ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦ï¼š</p>
<pre><code class="sh">cfssl gencert -ca=/etc/kubernetes/pki/ca.crt -ca-key=/etc/kubernetes/pki/ca.key -config=ca-config.json -profile=client apiserver-kubelet-client-csr.json | cfssljson -bare /etc/kubernetes/pki/apiserver-kubelet-client &amp;&amp; \
rm -f apiserver-kubelet-client.csr apiserver-kubelet-client-csr.json &amp;&amp; \
mv apiserver-kubelet-client.pem apiserver-kubelet-client.crt &amp;&amp; \
mv apiserver-kubelet-client-key.pem apiserver-kubelet-client.key
</code></pre>
<h2 id="front-proxy-è¯ä¹¦ç”Ÿæˆ"><a href="#front-proxy-è¯ä¹¦ç”Ÿæˆ" class="headerlink" title="front-proxy è¯ä¹¦ç”Ÿæˆ"></a>front-proxy è¯ä¹¦ç”Ÿæˆ</h2><p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/tasks/extend-kubernetes/configure-aggregation-layer/">é…ç½®èšåˆå±‚</a></p>
<p>åˆ›å»º ca ç­¾åè¯·æ±‚(<code>front-proxy-ca-csr.json</code>)ï¼š</p>
<pre><code class="json">&#123;
  &quot;CN&quot;: &quot;kubernetes-front-proxy-ca&quot;,
  &quot;key&quot;: &#123;
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
  &#125;
&#125;
</code></pre>
<p>ç”Ÿæˆ CA è¯ä¹¦ï¼š</p>
<pre><code class="sh">cfssl gencert -initca front-proxy-ca-csr.json | cfssljson -bare /etc/kubernetes/pki/front-proxy-ca
rm -f front-proxy-ca-csr.json front-proxy-ca.csr
mv front-proxy-ca.pem front-proxy-ca.crt
mv front-proxy-ca-key.pem front-proxy-ca.key
</code></pre>
<p>åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦ç­¾åè¯·æ±‚(<code>front-proxy-client-csr.json</code>)ï¼š</p>
<pre><code class="json">&#123;
  &quot;CN&quot;: &quot;front-proxy-client&quot;,
  &quot;key&quot;: &#123;
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
  &#125;
&#125;
</code></pre>
<p>ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦ï¼š</p>
<pre><code class="sh">cfssl gencert -ca=/etc/kubernetes/pki/front-proxy-ca.crt -ca-key=/etc/kubernetes/pki/front-proxy-ca.key -config=ca-config.json -profile=kubernetes front-proxy-client-csr.json | cfssljson -bare /etc/kubernetes/pki/front-proxy-client
rm -f front-proxy-client.csr front-proxy-client-csr.json
mv front-proxy-client.pem front-proxy-client.crt
mv front-proxy-client-key.pem front-proxy-client.key
</code></pre>
<h2 id="ä¸ºæœåŠ¡è´¦å·é…ç½®è¯ä¹¦"><a href="#ä¸ºæœåŠ¡è´¦å·é…ç½®è¯ä¹¦" class="headerlink" title="ä¸ºæœåŠ¡è´¦å·é…ç½®è¯ä¹¦"></a>ä¸ºæœåŠ¡è´¦å·é…ç½®è¯ä¹¦</h2><p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/setup/best-practices/certificates/#configure-certificates-for-user-accounts">ä¸ºæœåŠ¡è´¦å·é…ç½®è¯ä¹¦</a></p>
<p>è¿™é‡Œçš„è¯ä¹¦ä¸éœ€è¦æ”¾åœ¨ pki ä¸‹ï¼Œåˆ›å»ºå®Œåä¸€èˆ¬å°±ä¸å†éœ€è¦äº†ï¼Œæ‰€ä»¥å¯ä»¥æ”¾åœ¨ä¸€ä¸ªä¸´æ—¶ç›®å½•ä¸­ï¼Œä¾‹å¦‚ <code>/etc/kubernetes/serviceaccount</code>ï¼š</p>
<h3 id="controller-manager-è¯ä¹¦ç”Ÿæˆ"><a href="#controller-manager-è¯ä¹¦ç”Ÿæˆ" class="headerlink" title="controller-manager è¯ä¹¦ç”Ÿæˆ"></a>controller-manager è¯ä¹¦ç”Ÿæˆ</h3><p>åˆ›å»ºè¯ä¹¦ç”Ÿæˆè¯·æ±‚(<code>controller-manager-csr.json</code>)ï¼š</p>
<pre><code class="json">&#123;
  &quot;CN&quot;: &quot;system:kube-controller-manager&quot;,
  &quot;key&quot;: &#123;
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
  &#125;,
  &quot;names&quot;: [
    &#123;
      &quot;C&quot;: &quot;CN&quot;,
      &quot;ST&quot;: &quot;Beijing&quot;,
      &quot;L&quot;: &quot;Beijing&quot;,
      &quot;OU&quot;: &quot;kubernetes&quot;
    &#125;
  ]
&#125;
</code></pre>
<p>ç”Ÿæˆè¯ä¹¦ï¼š</p>
<pre><code class="sh">cfssl gencert \
  -ca=/etc/kubernetes/pki/ca.crt \
  -ca-key=/etc/kubernetes/pki/ca.key \
  -config=/etc/kubernetes/pki/ca-config.json \
  -profile=client \
  controller-manager-csr.json | cfssljson -bare /etc/kubernetes/serviceaccount/controller-manager
</code></pre>
<p>é…ç½®æœåŠ¡è´¦å·è¯ä¹¦ï¼š</p>
<pre><code class="sh">kube=/etc/kubernetes/controller-manager.conf

KUBECONFIG=$kube kubectl config set-cluster kubernetes --server=https://192.168.1.250:6443 --certificate-authority /etc/kubernetes/pki/ca.crt --embed-certs

KUBECONFIG=$kube kubectl config set-credentials system:kube-controller-manager --client-key /etc/kubernetes/serviceaccount/controller-manager-key.pem --client-certificate /etc/kubernetes/serviceaccount/controller-manager.pem --embed-certs

KUBECONFIG=$kube kubectl config set-context system:kube-controller-manager@kubernetes --cluster kubernetes --user system:kube-controller-manager

KUBECONFIG=$kube kubectl config use-context system:kube-controller-manager@kubernetes
</code></pre>
<h3 id="scheduler-è¯ä¹¦ç”Ÿæˆä¸é…ç½®"><a href="#scheduler-è¯ä¹¦ç”Ÿæˆä¸é…ç½®" class="headerlink" title="scheduler è¯ä¹¦ç”Ÿæˆä¸é…ç½®"></a>scheduler è¯ä¹¦ç”Ÿæˆä¸é…ç½®</h3><p>åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚(<code>scheduler-csr.json</code>)ï¼š</p>
<pre><code class="json">&#123;
  &quot;CN&quot;: &quot;system:kube-scheduler&quot;,
  &quot;key&quot;: &#123;
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
  &#125;,
  &quot;names&quot;: [
    &#123;
      &quot;C&quot;: &quot;CN&quot;,
      &quot;ST&quot;: &quot;Beijing&quot;,
      &quot;L&quot;: &quot;Beijing&quot;,
      &quot;OU&quot;: &quot;Kubernetes&quot;
    &#125;
  ]
&#125;
</code></pre>
<p>ç­¾å‘è¯ä¹¦ï¼š</p>
<pre><code class="sh">cfssl gencert \
  -ca=/etc/kubernetes/pki/ca.crt \
  -ca-key=/etc/kubernetes/pki/ca.key \
  -config=/etc/kubernetes/pki/ca-config.json \
  -profile=client \
  scheduler-csr.json | cfssljson -bare /etc/kubernetes/serviceaccount/scheduler
</code></pre>
<p>ç”Ÿæˆé…ç½®ï¼š</p>
<pre><code class="sh">kube=/etc/kubernetes/scheduler.conf

KUBECONFIG=$kube kubectl config set-cluster kubernetes --server=https://192.168.1.250:6443 --certificate-authority /etc/kubernetes/pki/ca.crt --embed-certs

KUBECONFIG=$kube kubectl config set-credentials system:kube-scheduler --client-key /etc/kubernetes/serviceaccount/scheduler-key.pem --client-certificate /etc/kubernetes/serviceaccount/scheduler.pem --embed-certs

KUBECONFIG=$kube kubectl config set-context system:kube-scheduler@kubernetes --cluster kubernetes --user system:kube-scheduler

KUBECONFIG=$kube kubectl config use-context system:kube-scheduler@kubernetes
</code></pre>
<h3 id="admin-è¯ä¹¦ç”Ÿæˆä¸é…ç½®"><a href="#admin-è¯ä¹¦ç”Ÿæˆä¸é…ç½®" class="headerlink" title="admin è¯ä¹¦ç”Ÿæˆä¸é…ç½®"></a>admin è¯ä¹¦ç”Ÿæˆä¸é…ç½®</h3><p>æ‡’å¾—è¯¦ç»†è¯´äº†ï¼Œç›´æ¥è´´æŒ‡ä»¤(<code>admin-csr.json</code>)ï¼š</p>
<pre><code class="json">&#123;
  &quot;CN&quot;: &quot;kubernetes-admin&quot;,
  &quot;key&quot;: &#123;
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
  &#125;,
  &quot;names&quot;: [
    &#123;
      &quot;C&quot;: &quot;CN&quot;,
      &quot;ST&quot;: &quot;Beijing&quot;,
      &quot;L&quot;: &quot;Beijing&quot;,
      &quot;O&quot;: &quot;system:masters&quot;,
      &quot;OU&quot;: &quot;Kubernetes&quot;
    &#125;
  ]
&#125;
</code></pre>
<p>ç­¾å‘è¯ä¹¦ï¼š</p>
<pre><code class="sh">cfssl gencert \
  -ca=/etc/kubernetes/pki/ca.crt \
  -ca-key=/etc/kubernetes/pki/ca.key \
  -config=/etc/kubernetes/pki/ca-config.json \
  -profile=client \
  admin-csr.json | cfssljson -bare /etc/kubernetes/serviceaccount/admin
</code></pre>
<p>ç”Ÿæˆé…ç½®ï¼š</p>
<pre><code class="sh">kube=/etc/kubernetes/admin.conf

KUBECONFIG=$kube kubectl config set-cluster kubernetes --server=https://192.168.1.33:6443 --certificate-authority /etc/kubernetes/pki/ca.crt --embed-certs

KUBECONFIG=$kube kubectl config set-credentials kubernetes-admin --client-key /etc/kubernetes/serviceaccount/admin-key.pem --client-certificate /etc/kubernetes/serviceaccount/admin.pem --embed-certs

KUBECONFIG=$kube kubectl config set-context kubernetes-admin@kubernetes --cluster kubernetes --user 	kubernetes-admin

KUBECONFIG=$kube kubectl config use-context kubernetes-admin@kubernetes
</code></pre>
<h3 id="ServiceAccount-Key-ç”Ÿæˆ"><a href="#ServiceAccount-Key-ç”Ÿæˆ" class="headerlink" title="ServiceAccount Key ç”Ÿæˆ"></a>ServiceAccount Key ç”Ÿæˆ</h3><p>K8s åº•å±‚ï¼Œæ¯åˆ›å»ºä¸€ä¸ª ServiceAccountï¼Œéƒ½ä¼šåˆ†é…ä¸€ä¸ª Secretï¼Œè€Œ Secret é‡Œé¢æœ‰ç§˜é’¥ï¼Œç§˜é’¥å°±æ˜¯ç”±æˆ‘ä»¬æ¥ä¸‹æ¥çš„ sa ç”Ÿæˆçš„ã€‚æ‰€ä»¥éœ€è¦æå‰åˆ›å»ºå‡º sa ä¿¡æ¯(RSAåŠ å¯†çš„å…¬é’¥å’Œç§é’¥)ï¼š</p>
<pre><code class="sh">openssl genrsa -out /etc/kubernetes/pki/sa.key 2048

openssl rsa -in /etc/kubernetes/pki/sa.key -pubout -out /etc/kubernetes/pki/sa.pub
</code></pre>
<h3 id="åŒæ­¥é…ç½®æ–‡ä»¶"><a href="#åŒæ­¥é…ç½®æ–‡ä»¶" class="headerlink" title="åŒæ­¥é…ç½®æ–‡ä»¶"></a>åŒæ­¥é…ç½®æ–‡ä»¶</h3><p>æœ€åï¼Œå°†åˆ›å»ºå¥½çš„é…ç½®æ–‡ä»¶å‘é€åˆ°å…¶å®ƒèŠ‚ç‚¹ï¼š</p>
<pre><code class="sh">scp /etc/kubernetes/admin.conf k8s-master-2:/etc/kubernetes/admin.conf
scp /etc/kubernetes/controller-manager.conf k8s-master-2:/etc/kubernetes/controller-manager.conf
scp /etc/kubernetes/scheduler.conf k8s-master-2:/etc/kubernetes/scheduler.conf
</code></pre>
<h1 id="å¯åŠ¨æ‰€æœ‰ç»„ä»¶"><a href="#å¯åŠ¨æ‰€æœ‰ç»„ä»¶" class="headerlink" title="å¯åŠ¨æ‰€æœ‰ç»„ä»¶"></a>å¯åŠ¨æ‰€æœ‰ç»„ä»¶</h1><p>æ—¥å¿—çº§åˆ«ï¼š</p>
<ul>
<li><code>--v=0</code> é€šå¸¸å¯¹æ­¤æœ‰ç”¨ï¼Œ<em>å§‹ç»ˆ</em>å¯¹è¿ç»´äººå‘˜å¯è§ã€‚</li>
<li><code>--v=1</code> å¦‚æœæ‚¨ä¸æƒ³è¦è¯¦ç»†ç¨‹åº¦ï¼Œåˆ™ä¸ºåˆç†çš„é»˜è®¤æ—¥å¿—çº§åˆ«ã€‚</li>
<li><code>--v=2</code> æœ‰å…³æœåŠ¡çš„æœ‰ç”¨ç¨³å®šçŠ¶æ€ä¿¡æ¯ä»¥åŠå¯èƒ½ä¸ç³»ç»Ÿä¸­çš„é‡å¤§æ›´æ”¹ç›¸å…³çš„é‡è¦æ—¥å¿—æ¶ˆæ¯ã€‚è¿™æ˜¯å¤§å¤šæ•°ç³»ç»Ÿçš„å»ºè®®é»˜è®¤æ—¥å¿—çº§åˆ«ã€‚</li>
<li><code>--v=3</code> æœ‰å…³æ›´æ”¹çš„æ‰©å±•ä¿¡æ¯ã€‚</li>
<li><code>--v=4</code> Debug çº§åˆ«ã€‚</li>
<li><code>--v=6</code> æ˜¾ç¤ºè¯·æ±‚çš„èµ„æºã€‚</li>
<li><code>--v=7</code> æ˜¾ç¤º HTTP è¯·æ±‚å¤´ã€‚</li>
<li><code>--v=8</code> æ˜¾ç¤º HTTP è¯·æ±‚å†…å®¹ã€‚</li>
<li><code>--v=9</code> æ˜¾ç¤º HTTP è¯·æ±‚å†…å®¹è€Œä¸æˆªæ–­å†…å®¹ã€‚</li>
</ul>
<h2 id="å¯åŠ¨-ApiServer"><a href="#å¯åŠ¨-ApiServer" class="headerlink" title="å¯åŠ¨ ApiServer"></a>å¯åŠ¨ ApiServer</h2><p><strong>åœ¨å¯åŠ¨å‰åº”è¯¥å…ˆé…ç½®å¥½ apiserver çš„è´Ÿè½½å‡è¡¡</strong>ï¼Œå…·ä½“å°±ä¸å±•ç¤ºäº†ï¼Œå¾ˆç®€å•ã€‚</p>
<p>åˆ›å»ºå¿…è¦çš„ç›®å½•ï¼š</p>
<pre><code class="sh">mkdir -p /etc/kubernetes/manifests/ /etc/systemd/system/kubelet.service.d /var/lib/kubelet /var/log/kubernetes
</code></pre>
<h3 id="é…ç½®-ApiServer-æœåŠ¡"><a href="#é…ç½®-ApiServer-æœåŠ¡" class="headerlink" title="é…ç½® ApiServer æœåŠ¡"></a>é…ç½® ApiServer æœåŠ¡</h3><p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-apiserver/">kube-apiserver</a></p>
<p>æ‰€æœ‰ Master èŠ‚ç‚¹åˆ›å»º kube-apiserver.serviceã€‚</p>
<blockquote>
<p>å¦‚æœä¸æ˜¯é«˜å¯ç”¨é›†ç¾¤ï¼Œ192.168.0.250 (è´Ÿè½½å‡è¡¡ ip) åº”è¯¥æ”¹ä¸ºæœ¬æœºçš„ ip<br>ä»¥ä¸‹æ–‡æ¡£ä½¿ç”¨çš„ k8s service ç½‘æ®µä¸º 10.96.0.0&#x2F;16ï¼Œè¯¥ç½‘æ®µä¸èƒ½å–å®¿ä¸»æœºçš„ç½‘æ®µã€Podç½‘æ®µé‡å <br><del>ç‰¹åˆ«æ³¨æ„ï¼šdocker çš„ç½‘æ¡¥é»˜è®¤ä¸º 172.17.0.1&#x2F;16ï¼Œä¸è¦ä½¿ç”¨è¿™ä¸ªç½‘æ®µ</del> (å­˜ç–‘ï¼Œç°åœ¨éƒ½æ˜¯ containerd äº†)</p>
</blockquote>
<p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p>
<pre><code class="sh"># --advertise-address éœ€è¦æ”¹ä¸ºæœ¬masterèŠ‚ç‚¹çš„ip
# --service-cluster-ip-range éœ€è¦æ”¹ä¸ºè‡ªå·±è§„åˆ’çš„æœåŠ¡ç½‘æ®µ
# --etcd-servers: æ”¹ä¸ºè‡ªå·±etcd-serverçš„æ‰€æœ‰åœ°å€
cat &lt;&lt; EOF &gt; /usr/lib/systemd/system/kube-apiserver.service
[unit]
Description=Kubernetes API Server
Documentation=https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-apiserver/
After=network.target

[Service]
ExecStart=/usr/local/bin/kube-apiserver \\
  --v=2 \\
  --allow-privileged=true \\
  --bind-address=0.0.0.0 \\
  --secure-port=6443 \\
  --advertise-address=æœºå™¨ ip \\
  --service-cluster-ip-range=10.96.0.0/16 \\
  --service-node-port-range=30000-32767 \\
  --etcd-servers=https://192.168.1.26:2379,https://192.168.1.28:2379,https://192.168.1.29:2379 \\
  --etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt \\
  --etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt \\
  --etcd-keyfile=/etc/kubernetes/pki/apiserver-etcd-client.key \\
  --client-ca-file=/etc/kubernetes/pki/ca.crt \\
  --tls-cert-file=/etc/kubernetes/pki/apiserver.crt \\
  --tls-private-key-file=/etc/kubernetes/pki/apiserver.key \\
  --kubelet-client-certificate=/etc/kubernetes/pki/apiserver-kubelet-client.crt \\
  --kubelet-client-key=/etc/kubernetes/pki/apiserver-kubelet-client.key \\
  --service-account-key-file=/etc/kubernetes/pki/sa.pub \\
  --service-account-signing-key-file=/etc/kubernetes/pki/sa.key \\
  --service-account-issuer=https://kubernetes.default.svc.cluster.local \\
  --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname \\
  --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota \\
  --authorization-mode=Node,RBAC \\
  --enable-bootstrap-token-auth=true \\
  --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt \\
  --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.crt \\
  --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client.key \\
  --requestheader-allowed-names=aggregator,front-proxy-client \\
  --requestheader-username-headers=X-Remote-User \\
  --requestheader-group-headers=X-Remote-Group \\
  --requestheader-extra-headers-prefix=X-Remote-Extra-
  # --token-auth-file 

Restart=on-failure
RestartSec=10s
LimitNOFILE=65535

[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload &amp;&amp; systemctl enable --now kube-apiserver

systemctl status kube-apiserver
</code></pre>
<h2 id="å¯åŠ¨-controller-manager"><a href="#å¯åŠ¨-controller-manager" class="headerlink" title="å¯åŠ¨ controller-manager"></a>å¯åŠ¨ controller-manager</h2><p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-controller-manager/">kube-controller-manager</a></p>
<pre><code class="sh"># --cluster-cidr æ˜¯ Pod çš„ ip èŒƒå›´
cat &lt;&lt; EOF &gt; /usr/lib/systemd/system/kube-controller-manager.service
[Unit]
Description=Kubernetes Controller Manager
Documentation=https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-controller-manager/
After=network.target

[Service]
ExecStart=/usr/local/bin/kube-controller-manager \\
  --v=2 \\
  --root-ca-file=/etc/kubernetes/pki/ca.crt \\
  --cluster-signing-cert-file=/etc/kubernetes/pki/ca.crt \\
  --cluster-signing-key-file=/etc/kubernetes/pki/ca.key \\
  --service-account-private-key-file=/etc/kubernetes/pki/sa.key \\
  --kubeconfig=/etc/kubernetes/controller-manager.conf \\
  --use-service-account-credentials=true \\
  --controllers=*,bootstrap-signer-controller,token-cleaner-controller \\
  --allocate-node-cidrs=true \\
  --cluster-cidr=196.16.0.0/16 \\
  --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt \\
  

Restart=on-failure
RestartSec=10s

[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload &amp;&amp; systemctl enable --now kube-controller-manager

systemctl status kube-controller-manager
</code></pre>
<h2 id="å¯åŠ¨-scheduler"><a href="#å¯åŠ¨-scheduler" class="headerlink" title="å¯åŠ¨ scheduler"></a>å¯åŠ¨ scheduler</h2><p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-scheduler/">kube-scheduler</a></p>
<pre><code class="sh">cat &lt;&lt; EOF &gt; /usr/lib/systemd/system/kube-scheduler.service
[Unit]
Description=Kubernetes Scheduler
Documentation=https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-scheduler/
After=network.target

[Service]
ExecStart=/usr/local/bin/kube-scheduler \\
  --v=2 \\
  --kubeconfig=/etc/kubernetes/scheduler.conf

Restart=on-failure
RestartSec=10s
[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload &amp;&amp; systemctl enable --now kube-scheduler

systemctl status kube-scheduler
</code></pre>
<h1 id="æ¥ä¸‹æ¥"><a href="#æ¥ä¸‹æ¥" class="headerlink" title="æ¥ä¸‹æ¥"></a>æ¥ä¸‹æ¥</h1><p>åˆ°ç›®å½•ä¸ºæ­¢ï¼Œæ‰€æœ‰ä¸»èŠ‚ç‚¹éœ€è¦çš„ç»„ä»¶å·²ç»å…¨éƒ¨éƒ¨ç½²å®Œæˆï¼Œåç»­åˆ™æ˜¯ kubelet ç­‰ç»„ä»¶çš„éƒ¨ç½²ã€‚</p>
<p>ä¸ºé¿å…ç« èŠ‚è¿‡é•¿ï¼Œæ‰€ä»¥å¯¹æ–‡ç« è¿›è¡Œäº†åˆ†èŠ‚ï¼š</p>
<ul>
<li><a href="/kubernetes/high-available-p2">é«˜å¯ç”¨é›†ç¾¤ P2</a></li>
</ul>

    </div>
    
    
    
    
    <div id="comment">
        <div id="giscus-container" class="giscus"></div>
    </div>
    
    
    
    
</div>

                <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 IceOfSummerã®åšå®¢
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;<a target="_blank" rel="noopener" href="https://github.com/IceOfSummer">IceOfSummer</a>
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/IceOfSummer/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

            </div>
            </transition>
            
            <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
            </transition>
            
        </div>
        <script src="/js/main.js"></script>
        
        
<script
    src="https://giscus.app/client.js"
    data-repo="IceOfSummer/iceofsummer.github.io"
    data-repo-id="R_kgDOJFU7OQ"
    data-category="Announcements"
    data-category-id="DIC_kwDOJFU7Oc4CUyC7"
    data-mapping="title"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="preferred_color_scheme"
    data-lang="zh-CN"
    crossorigin
    async
></script>





        
    </body>
</html>
